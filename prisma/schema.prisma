// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  SUPERADMIN
  ADMIN
  TEACHER
}

enum StaffStatus {
  ACTIVE
  INACTIVE
}

enum StudentStatus {
  ACTIVE
  INACTIVE
  GRADUATED
}

enum Level {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum GroupStatus {
  PLANNED
  ACTIVE
  COMPLETED
}

enum StudentGroupStatus {
  ACTIVE
  INACTIVE
  COMPLETED
}

model Staff {
  id        Int         @id @default(autoincrement())
  firstName String      @map("first_name")
  lastName  String      @map("last_name")
  username  String      @unique
  email     String?     @unique
  password  String
  role      Role
  position  String
  phone     String?
  address   String?
  hireDate  DateTime    @default(now()) @map("hire_date")
  status    StaffStatus @default(ACTIVE)
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @default(now()) @map("updated_at")

  groups Group[] @relation("TeacherGroups")
}

model Student {
  id             Int           @id @default(autoincrement())
  firstName      String        @map("first_name")
  lastName       String        @map("last_name")
  password       String?
  phone          String?
  address        String?
  birthDate      DateTime?     @map("birth_date")
  status         StudentStatus @default(ACTIVE)
  enrollmentDate DateTime      @default(now()) @map("enrollment_date")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @default(now()) @map("updated_at")

  studentGroups StudentGroup[]
}

model Course {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  price       Int
  duration    Int
  level       Level?
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @map("updated_at")

  groups Group[]
}

model Group {
  id          Int         @id @default(autoincrement())
  name        String
  courseId    Int?
  teacherId   Int?
  startDate   DateTime    @map("start_date")
  endDate     DateTime?   @map("end_date")
  schedule    String?
  maxStudents Int         @default(20) @map("max_students")
  status      GroupStatus @default(PLANNED)
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @default(now()) @map("updated_at")

  course        Course?        @relation(fields: [courseId], references: [id])
  teacher       Staff?         @relation("TeacherGroups", fields: [teacherId], references: [id])
  studentGroups StudentGroup[]
}

model StudentGroup {
  id        Int                @id @default(autoincrement())
  studentId Int
  groupId   Int
  joinDate  DateTime           @default(now()) @map("join_date")
  status    StudentGroupStatus @default(ACTIVE)
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @default(now()) @map("updated_at")

  student Student @relation(fields: [studentId], references: [id])
  group   Group   @relation(fields: [groupId], references: [id])

  @@unique([studentId, groupId])
}
